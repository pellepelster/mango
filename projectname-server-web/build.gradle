apply plugin: 'war'
apply plugin: 'jettyEclipse'

buildscript {

	repositories { 
		jcenter() 
	}

	dependencies {
		classpath (group: 'com.sahlbach.gradle', name: 'gradle-jetty-eclipse-plugin', version: '1.9.+')
		classpath "org.apache.derby:derby:10.9.1.0"
		classpath 'commons-dbcp:commons-dbcp:1.4'
	}
}

dependencies {

	compile project(path: ':projectname-model')
	compile project(path: ':projectname-model', configuration: 'generatedEntities')
	compile project(path: ':projectname-model', configuration: 'generatedVOs' )

	compile group: 'org.slf4j', name: 'slf4j-log4j12', version: '1.7.5'
	compile group: 'org.slf4j', name: 'slf4j-api', version: '1.7.5'
	compile group: 'log4j', name: 'log4j', version: '1.2.17'

	compile group: 'io.pelle.mango', name: 'mango-server', version: '+'

	compile (group: 'org.springframework.data', name: 'spring-data-jpa', version: '1.4.3.RELEASE') {
		exclude group: 'org.slf4j'
	}
	
	compile group: 'com.fasterxml.jackson.core', name: 'jackson-core', version: '2.3.1'
	compile group: 'com.fasterxml.jackson.core', name: 'jackson-databind', version: '2.3.1'
	compile group: 'org.apache.commons', name: 'commons-io', version: '1.3.2'
	compile group: 'commons-fileupload', name: 'commons-fileupload', version: '1.3.1'
	compile group: 'org.apache.httpcomponents', name: 'httpclient', version: '4.2.6'
	compile group: "org.hsqldb", name: "hsqldb", version: "2.2.9"
	
	testCompile group: 'com.jayway.awaitility', name: 'awaitility', version: '1.5.0'
	testCompile group: 'com.jayway.restassured', name: 'rest-assured', version: '2.3.0'
	testCompile group: 'junit', name: 'junit', version: '4.11'
	testCompile group: "org.springframework", name: "spring-test", version: '4.0.3.RELEASE'
	testCompile group: "org.apache.tomcat", name: "dbcp", version: '6.0.39'
	testCompile group: 'io.pelle.mango', name: 'mango-db', version: '+'
	
}

jettyEclipse { 
	jettyConfig = file('test/jetty-env.xml') 
	httpPort = 9090
}

war {
	from 'war'
	webInf { from 'src/WEB-INF' }
	metaInf { from 'src/META-INF' }
	//classpath fileTree('additionalLibs') // adds a file-set to the WEB-INF/lib dir.
	//classpath configurations.moreLibs // adds a configuration to the WEB-INF/lib dir.
	//webXml = file('WebContent/WEB-INF/web.xml')
}

task jettyEclipseRunDaemon() {
	doLast {
		jettyEclipse.daemon = true
		tasks.jettyEclipseRun.execute() 
	} 
}

test.dependsOn(jettyEclipseRunDaemon)
